# Go的测试
## 分类
Go语言的测试一般分为三大类别，分别是：

1. 回归测试
2. 集成测试
3. 单元测试

由上到下，**覆盖率逐层变大**，成本却**逐层降低**

### 1. 单元测试
---> 输入 ---> 测试单元 ---> 输出 ---> **实际结果**

---------------期望-----------------> **预期结果**

其中，测试单元当中包括一些接口、函数和模块等等内容

通过单元测试，我们可以在**保证质量**的同时**提升效率**

**单元测试-规则**
+ 所有测试文件以 _test.go 来结尾
```
例如
myFile.go
myFile_test.go
```
+ func TestXxx(*testing.T)
```go
func TestPublishPost(t *testing.T) {
    //xxx
}
```
+ 初始化逻辑放到TestMain当中
```go
func TestMain(m *testing.M) {
    //测试前：数据装载、配置初始化等前置工作

    code := m.Run()

    //测试后：释放资源等收尾工作

    //退出
    os.Exit()
}
```

**单元测试-Tips**
+ 一般覆盖率：50%-60%，较高覆盖率80%+
+ 测试分支相互独立、全面覆盖
+ 测试单元粒度足够小、函数单一职责

**单元测试-依赖**

单元依赖可以是File、DB或者是Cache

我们的单元测试需要做到两大目标**幂等**和**稳定**
1. **幂等**，当我们重复去运行一个测试的case的时候，与之前的结果是一样的
2. **稳定**，我们的单元测试是单独隔离的，可以在任何时间任何目的都能单独运行

**单元测试-Mock**
Mock可以使用一个开源库———— monkey

快速Mock函数
+ 为一个函数打桩
+ 为一个方法打桩

